<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  xmlns:vm="clr-namespace:GameClientMaui"
  xmlns:controls="clr-namespace:GameClientMaui"
  x:Class="GameClientMaui.SolitaireView">
  <ContentPage.Resources>
    <Style x:Key="PileColumnStyle" TargetType="Frame">
      <Setter Property="BackgroundColor" Value="Transparent" />
      <Setter Property="HasShadow" Value="False" />
      <Setter Property="Padding" Value="4" />
    </Style>
    <DataTemplate x:Key="CardTemplate">
      <!-- CardView expects a CardViewModel as its BindingContext -->
      <controls:CardView />
    </DataTemplate>
  </ContentPage.Resources>

  <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*">
    <!-- Top area: Deck, Waste, Foundations -->
    <Grid Grid.Row="0" Column="0" Padding="10" ColumnDefinitions="Auto,Auto,*,Auto,Auto,Auto,Auto" RowDefinitions="Auto">
      <!-- Deck / Draw -->
      <VerticalStackLayout Spacing="6" HorizontalOptions="Start">
        <Button Text="{Binding DeckCount, StringFormat='Deck ({0})'}"
                Command="{Binding DrawCommand}"
                WidthRequest="100" HeightRequest="48" />
        <Button Text="New Game"
                Command="{Binding NewGameCommand}"
                WidthRequest="100" HeightRequest="36" />
      </VerticalStackLayout>

      <!-- Waste -->
      <CollectionView ItemsSource="{Binding WasteDisplay}"
                      ItemTemplate="{StaticResource CardTemplate}"
                      SelectionMode="None"
                      HorizontalOptions="Start"
                      HeightRequest="120"
                      WidthRequest="80"
                      Grid.Column="1" />

      <!-- spacer -->
      <BoxView Grid.Column="2" />

      <!-- 4 Foundations -->
      <HorizontalStackLayout Grid.Column="3" Spacing="8" HorizontalOptions="End" HeightRequest="120">
        <!-- Foundation 1 -->
        <VerticalStackLayout WidthRequest="80" HeightRequest="120" Spacing="4">
          <VerticalStackLayout BindableLayout.ItemsSource="{Binding FoundationDisplay[0]}"
                               BindableLayout.ItemTemplate="{StaticResource CardTemplate}"
                               Spacing="2" />
        </VerticalStackLayout>

        <!-- Foundation 2 -->
        <VerticalStackLayout WidthRequest="80" HeightRequest="120" Spacing="4">
          <VerticalStackLayout BindableLayout.ItemsSource="{Binding FoundationDisplay[1]}"
                               BindableLayout.ItemTemplate="{StaticResource CardTemplate}"
                               Spacing="2" />
        </VerticalStackLayout>

        <!-- Foundation 3 -->
        <VerticalStackLayout WidthRequest="80" HeightRequest="120" Spacing="4">
          <VerticalStackLayout BindableLayout.ItemsSource="{Binding FoundationDisplay[2]}"
                               BindableLayout.ItemTemplate="{StaticResource CardTemplate}"
                               Spacing="2" />
        </VerticalStackLayout>

        <!-- Foundation 4 -->
        <VerticalStackLayout WidthRequest="80" HeightRequest="120" Spacing="4">
          <VerticalStackLayout BindableLayout.ItemsSource="{Binding FoundationDisplay[3]}"
                               BindableLayout.ItemTemplate="{StaticResource CardTemplate}"
                               Spacing="2" />
        </VerticalStackLayout>
      </HorizontalStackLayout>
    </Grid>

    <!-- Middle area: 7 tableau piles -->
    <ScrollView Grid.Row="1" Orientation="Horizontal" Padding="8">
      <HorizontalStackLayout Spacing="12" Padding="6">
        <!-- For each pile create a narrow column showing stacked cards -->
        <Frame Style="{StaticResource PileColumnStyle}">
          <VerticalStackLayout>
            <CollectionView ItemsSource="{Binding PilesDisplay[0]}"
                            ItemTemplate="{StaticResource CardTemplate}"
                            SelectionMode="None"
                            HeightRequest="420"
                            WidthRequest="92" />
            <Button Text="Move Waste Here"
                    Command="{Binding BindingContext.MoveWasteToPileCommand, Source={x:Reference PageRoot}}"
                    CommandParameter="0"
                    FontSize="12" />
          </VerticalStackLayout>
        </Frame>

        <Frame Style="{StaticResource PileColumnStyle}">
          <VerticalStackLayout>
            <CollectionView ItemsSource="{Binding PilesDisplay[1]}" ItemTemplate="{StaticResource CardTemplate}" SelectionMode="None" HeightRequest="420" WidthRequest="92" />
            <Button Text="Move Waste Here" Command="{Binding BindingContext.MoveWasteToPileCommand, Source={x:Reference PageRoot}}" CommandParameter="1" FontSize="12" />
          </VerticalStackLayout>
        </Frame>

        <Frame Style="{StaticResource PileColumnStyle}">
          <VerticalStackLayout>
            <CollectionView ItemsSource="{Binding PilesDisplay[2]}" ItemTemplate="{StaticResource CardTemplate}" SelectionMode="None" HeightRequest="420" WidthRequest="92" />
            <Button Text="Move Waste Here" Command="{Binding BindingContext.MoveWasteToPileCommand, Source={x:Reference PageRoot}}" CommandParameter="2" FontSize="12" />
          </VerticalStackLayout>
        </Frame>

        <Frame Style="{StaticResource PileColumnStyle}">
          <VerticalStackLayout>
            <CollectionView ItemsSource="{Binding PilesDisplay[3]}" ItemTemplate="{StaticResource CardTemplate}" SelectionMode="None" HeightRequest="420" WidthRequest="92" />
            <Button Text="Move Waste Here" Command="{Binding BindingContext.MoveWasteToPileCommand, Source={x:Reference PageRoot}}" CommandParameter="3" FontSize="12" />
          </VerticalStackLayout>
        </Frame>

        <Frame Style="{StaticResource PileColumnStyle}">
          <VerticalStackLayout>
            <CollectionView ItemsSource="{Binding PilesDisplay[4]}" ItemTemplate="{StaticResource CardTemplate}" SelectionMode="None" HeightRequest="420" WidthRequest="92" />
            <Button Text="Move Waste Here" Command="{Binding BindingContext.MoveWasteToPileCommand, Source={x:Reference PageRoot}}" CommandParameter="4" FontSize="12" />
          </VerticalStackLayout>
        </Frame>

        <Frame Style="{StaticResource PileColumnStyle}">
          <VerticalStackLayout>
            <CollectionView ItemsSource="{Binding PilesDisplay[5]}" ItemTemplate="{StaticResource CardTemplate}" SelectionMode="None" HeightRequest="420" WidthRequest="92" />
            <Button Text="Move Waste Here" Command="{Binding BindingContext.MoveWasteToPileCommand, Source={x:Reference PageRoot}}" CommandParameter="5" FontSize="12" />
          </VerticalStackLayout>
        </Frame>

        <Frame Style="{StaticResource PileColumnStyle}">
          <VerticalStackLayout>
            <CollectionView ItemsSource="{Binding PilesDisplay[6]}" ItemTemplate="{StaticResource CardTemplate}" SelectionMode="None" HeightRequest="420" WidthRequest="92" />
            <Button Text="Move Waste Here" Command="{Binding BindingContext.MoveWasteToPileCommand, Source={x:Reference PageRoot}}" CommandParameter="6" FontSize="12" />
          </VerticalStackLayout>
        </Frame>
      </HorizontalStackLayout>
    </ScrollView>

    <!-- Bottom area: status and quick actions -->
    <Grid Grid.Row="2" Padding="10" ColumnDefinitions="*,Auto">
      <Label Text="{Binding StatusMessage}" VerticalOptions="Center" FontSize="14" />
      <StackLayout Orientation="Horizontal" Spacing="8" Grid.Column="1" VerticalOptions="Center">
        <Button Text="Waste Foundation" Command="{Binding MoveWasteToFoundationCommand}" />
        <Label Text="{Binding IsGameWon, StringFormat='Won: {0}'}" VerticalOptions="Center" />
      </StackLayout>
    </Grid>
  </Grid>
</ContentPage>